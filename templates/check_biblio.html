{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
  <div class="row" id="main_Row">
    <div class="col-2 menu-sidebar" id="main_sidebar">
      {% include "menu.html" %}
    </div>
    <div class="col-7 main-container" id="main_container">
      
      <br>

      <div class="text-center" id="loader_check_biblio">

        {% if not isBiblioSelected %}
          Select a file and wait...
        {% endif %}
      </div>

      <div class="zone_filePDF">
        <embed src="{{ file_selected.file.url }}" width="100%" height="350px" />
      </div>

      <hr>

      {% if isBiblioSelected %}
        {% if isDOIValid %}
          <div class="alert alert-success" role="alert">

            <h5>Reference found</h5>

            Title: <b>{{ doiTitle }}</b>
            <br>
            Authors: {{ doiAuthors }}
            <br>
            Journal: {{ doiJournal }}
            <br>
            Date: {{ doiDate }}

            <form action="/check_biblio" method="post">
              {% csrf_token %}
              <input type="hidden" name="validate_doi" value="{{ doi }}">
              <input type="hidden" name="validate_doi_id" value="{{ id_file }}">
              <input type="submit" value="Validate">
            </form>
        {% else %}
          <div class="alert alert-warning" role="alert">
          <h5>No reference found</h5>
        {% endif %}
          
            <br>

            <form action="/check_biblio/{{ id_file }}/" method="post">
              {% csrf_token %}
              {{ check_biblio_doi }}
              <input type="submit" value="Resubmit">
            </form>

          </div>
          <div class="alert alert-secondary" role="alert">

            <h5>Search engine</h5>

            If the file DOI is not found, you can start a manual research. Recommanded keywords: full title.

            <form action="/check_biblio/{{ id_file }}/" method="post">
              {% csrf_token %}
              {{ check_biblio_crossRefQuery }}
              <input type="submit" value="Search">
            </form>

            {% for item in parsed_items %}
              <br>
              Title: <b>{{ item.title }}</b>
              <br>
              Authors: {{ item.authors }}
              <br>
              Journal: {{ item.journal }}
              <br>
              Date: {{ item.date }}
              <br>
              DOI: {{ item.doi }}
              <br>
              <form action="/check_biblio" method="post">
                {% csrf_token %}
                <input type="hidden" name="validate_doi" value="{{ item.doi }}">
                <input type="hidden" name="validate_doi_id" value="{{ id_file }}">
                <input type="submit" value="Validate">
              </form>
              <br>
              <hr>
            {% endfor %}

          </div>
      {% endif %}
      
      <br>
      <div style="position: absolute; bottom: 10px; right: 20px;">Database from <a href="https://search.crossref.org/" target="_blank"><img style="height: 20px; margin-top: -5px; margin-left: 5px;" src="//assets.crossref.org/logo/crossref-logo-landscape-200.png"></a></div>

    </div>
    <div class="col-3 detail-right" id="main_detail">
        
      <br>

      <div class="table-responsive">
        <table width="400px" style="table-layout:fixed;" class="table table-bordered table-hover table-striped" id="table_checkBiblio">
          <thead class="table-header">
            <tr>             
              <th width="0px"></th>
              <th width="160px">Upload on</th>
              <th width="800px">File name</th>
              <th width="70px">Remove</th>
            </tr>
          </thead>
          <tbody>
          {% for file_i in file_to_sort %}
            <tr id="listToSort_{{ file_i.id }}" class="table-item {% if file_i.id == file_selected.id %} table-selected {% endif %} ">
              <td id="appadd">{{ file_i.id }}</td>
              <td id="appadd">{{ file_i.created_on }}</td>
              <td id="appadd">{{ file_i.file.name }}</td>
              <td id="appadd">
                <form action="/check_biblio" method="post">
                  {% csrf_token %}
                  <button name="del_toSort" value="{{ file_i.id }}"><span class='fas fa-trash-alt'></span></button>
                </form>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
{%endblock%}

